#include<Date.au3>
#include <IE.au3>
#include <GUIConstantsEx.au3>
#include <MsgBoxConstants.au3>
#include <Excel.au3>
MsgBox(0,"Check Your IE","Check that you are logged into SelfServe, and you have no Excel Application/Workbooks open")
Local $oIE = _IEAttach("SelfServe")
Local $oObject = _IEGetObjByName($oIE,"applications")
_IEAction($oObject, "click")
_IELoadWait($oIE)
_IELinkClickByText($oIE, "Vocera")
_IELoadWait($oIE)
_IELinkClickByText($oIE, "Create Extract")
WinWaitActive("Windows Internet Explorer")
Sleep(1000)
Local $hWnd1 = WinWait("Windows Internet Explorer", "", 20)
ControlClick($hWnd1, "", "Button3")
Sleep(2000)
Local $hWnd = WinWait("Save As", "", 20)
Sleep(2000)
ControlClick("Save As", "", "[CLASS:ToolbarWindow32; INSTANCE:3]", "right")
ControlSend("Save As", "", "[CLASS:ToolbarWindow32; INSTANCE:3]", "e")
Sleep(1000)
ControlSend("Save As", "", "[CLASS:Edit; INSTANCE:1]", "^a")
ControlSend("Save As", "", "[CLASS:Edit; INSTANCE:1]", "{DEL}")
ControlSend("Save As", "", "[CLASS:Edit; INSTANCE:1]", @MON&"_"&@MDAY&"_"&@YEAR&"_voceraData.xls")
Sleep(1000)
ControlSend("Save As", "", "[CLASS:Edit; INSTANCE:2]", @ScriptDir)
Sleep(1000)
ControlSend("Save As", "", "[CLASS:Edit; INSTANCE:2]", "{ENTER}")
Sleep(1000)
ControlClick($hWnd, "", "Button1")
;ControlClick($hWnd2, "", "Button4")
Sleep(5000)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
Local $oExcel = _Excel_Open()
Sleep(2000)
WinWait("Microsoft Excel")
Local $oWorkbook = _Excel_BookOpen($oExcel,@ScriptDir&"\"&@MON&"_"&@MDAY&"_"&@YEAR&"_voceraData.xls")
Sleep(5000)
$iRows = $oWorkbook.ActiveSheet.UsedRange.Rows.Count
Sleep(2000)
ControlSend("Microsoft Excel - "&@MON&"_"&@MDAY&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:EXCEL7; INSTANCE:1]", "+{SPACE}")
Sleep(2000)
ControlSend("Microsoft Excel - "&@MON&"_"&@MDAY&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:NetUIHWND; INSTANCE:2]", "!h")
Sleep(2000)
ControlSend("Microsoft Excel - "&@MON&"_"&@MDAY&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:NetUIHWND; INSTANCE:2]", "d")
Sleep(2000)
ControlSend("Microsoft Excel - "&@MON&"_"&@MDAY&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:NetUIHWND; INSTANCE:2]", "d")
Sleep(2000)
ControlSend("Delete", "", "", "{ENTER}")
Sleep(2000)
_Excel_BookSave($oWorkbook)
Sleep(2000)
Local $oWorkbook2 = _Excel_BookOpen($oExcel,@ScriptDir&"\"&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls")
Sleep(5000)
$iRows2 = $oWorkbook2.ActiveSheet.UsedRange.Rows.Count
Sleep(2000)
#cs
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:EXCEL7; INSTANCE:2]", "+{SPACE}")
Sleep(2000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:NetUIHWND; INSTANCE:2]", "!h")
Sleep(2000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:NetUIHWND; INSTANCE:2]", "d")
Sleep(2000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:NetUIHWND; INSTANCE:2]", "d")
Sleep(2000)
ControlSend("Delete", "", "", "{ENTER}")
Sleep(2000)
#ce
_Excel_BookSave($oWorkbook2)
Sleep(5000)
$copyRange = "A1:AC"&($iRows)
$copyRange1 = "A"&($iRows2+1)
Local $oRange = $oWorkbook.Worksheets(1).Range($copyRange)
Sleep(5000)
_Excel_RangeCopyPaste($oWorkbook2.Worksheets(1), $oRange, $copyRange1)
Sleep(5000)
_Excel_RangeWrite($oWorkbook2, $oWorkbook2.Activesheet, "=CONCATENATE(A1,B1,C1,D1,E1,F1,G1,H1,I1,J1,K1,L1,M1,N1,O1,P1,R1,S1,T1,U1,V1,X1,Y1,AA1,AB1,AC1)", "AD1:AD"&($iRows+$iRows2), "False")
Sleep(5000)
_Excel_RangeWrite($oWorkbook2, $oWorkbook2.Activesheet, "=IF(ISERROR(COUNTIF($AD$1:$AD$"&($iRows+$iRows2)&",AD1)),0,COUNTIF($AD$1:$AD$"&($iRows+$iRows2)&",AD1))", "AE1:AE"&($iRows+$iRows2), "False")
Sleep(5000)
_Excel_RangeSort($oWorkbook2, Default, Default, "AE:AE", Default, Default, $xlYes)
Sleep(5000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:EXCEL7; INSTANCE:2]", "^{HOME}")
Sleep(5000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:EXCEL7; INSTANCE:2]", "^{RIGHT}")
Sleep(5000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:EXCEL7; INSTANCE:2]", "^{SPACE}")
Sleep(5000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:EXCEL7; INSTANCE:2]", "^c")
Sleep(5000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:NetUIHWND; INSTANCE:2]", "!h")
Sleep(2000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:NetUIHWND; INSTANCE:2]", "v")
Sleep(2000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:NetUIHWND; INSTANCE:2]", "v")
Sleep(4000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:EXCEL7; INSTANCE:2]", "^f")
Sleep(2000)
ControlSend("Find and Replace", "", "[CLASS:EDTBX; INSTANCE:1]", "1")
Sleep(2000)
ControlSend("Find and Replace", "", "[CLASS:EDTBX; INSTANCE:1]", "{TAB 2}")
Sleep(2000)
ControlSend("Find and Replace", "", "", "{ENTER}")
Sleep(2000)
ControlSend("Find and Replace", "", "", "^a")
Sleep(2000)
ControlSend("Find and Replace", "", "", "!{F4}")
Sleep(2000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:EXCEL7; INSTANCE:2]", "+{SPACE}")
Sleep(2000)
ControlSend("Microsoft Excel - "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls", "", "[CLASS:EXCEL7; INSTANCE:2]", "^c")
Sleep(2000)
Local $oWorkbook3 = _Excel_BookOpen($oExcel,@ScriptDir&"\Flagged.xlsx")
Sleep(5000)
ControlSend("Microsoft Excel - Flagged.xlsx", "", "[CLASS:EXCEL7; INSTANCE:3]", "{DOWN}")
Sleep(2000)
ControlSend("Microsoft Excel - Flagged.xlsx", "", "[CLASS:EXCEL7; INSTANCE:3]", "^v")
Sleep(2000)
ControlSend("Microsoft Excel - Flagged.xlsx", "", "[CLASS:EXCEL7; INSTANCE:3]", "^{UP}")
Sleep(2000)
ControlSend("Microsoft Excel - Flagged.xlsx", "", "[CLASS:EXCEL7; INSTANCE:3]", "+{SPACE}")
Sleep(2000)
ControlSend("Microsoft Excel - Flagged.xlsx", "", "[CLASS:NetUIHWND; INSTANCE:2]", "!h")
Sleep(2000)
ControlSend("Microsoft Excel - Flagged.xlsx", "", "[CLASS:NetUIHWND; INSTANCE:2]", "m")
Sleep(2000)
ControlSend("Microsoft Excel - Flagged.xlsx", "", "[CLASS:NetUIHWND; INSTANCE:2]", "m")
Sleep(2000)
ControlSend("Microsoft Excel - Flagged.xlsx", "", "[CLASS:EXCEL7; INSTANCE:3]", "Self Serve Extract Changes between "&@MON&"_"&(@MDAY-1)&"_"&@YEAR&" and "&@MON&"_"&(@MDAY)&"_"&@YEAR)
Sleep(2000)
_Excel_RangeSort($oWorkbook3, Default, Default, "G:G", Default, Default, $xlYes)
Sleep(2000)
ControlSend("Microsoft Excel - Flagged.xlsx", "", "[CLASS:EXCEL7; INSTANCE:3]", "^{DOWN}")
Sleep(2000)
ControlSend("Microsoft Excel - Flagged.xlsx", "", "[CLASS:EXCEL7; INSTANCE:3]", "{DOWN}")
Sleep(2000)
_Excel_BookSave($oWorkbook3)
Sleep(2000)
_Excel_Close($oExcel, Default, True)
Sleep(5000)
MsgBox(0,"What I should be deleting",@ScriptDir&"\"&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls")
FileDelete(@ScriptDir&"\"&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData.xls")
DirRemove(@ScriptDir&"\"&@MON&"_"&(@MDAY-1)&"_"&@YEAR&"_voceraData_files",1)